<html>

<head>
	<link rel="stylesheet" href="../styles.css">
	<link rel="stylesheet" href="combo-page-live.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>
	<script src="https://unpkg.com/currency.js@~1.0.0/dist/currency.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/numeral@2.0.6/numeral.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.0"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script src='https://unpkg.co/gsap@3/dist/gsap.min.js'></script>
	<script src='https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js'></script>
	<script src="../elt.js"></script>
	<script src="combo-page-live-settings.js"></script>
</head>

<body>
	<div class="info-container">
		<div class="box">
			<div class="triangle-element"></div>
		</div>
		<div class="team-name">
			<span id="" class="">PAPER HANDGRENADES</span>
		</div>
		<div class="el-year">
			<span>Extra Life 2024</span>
		</div>
		<div class="year">
			<span id="" class="">YEAR 11</span>
		</div>
		<div class="time">
			<span id="">TIME</span>
			<span id="hours" class="clock" onload="showTime()">00</span>
			<span class="colon">:</span>
			<span id="mins" class="clock" onload="showTime()">00</span>
		</div>
		<div class="timer">
			<span id="timer-header"></span>
			<span id="countdown-timer-time"></span>
		</div>
		<div class="goal">
			<span id="">Goal</span>
			<span id="goal"></span>
		</div>
		<div class="raised">
			<span id="">Raised</span>
			<span id="raised"></span>
		</div>
		<div class="swear-jar">
			<span>Swear Jar</span>
			<span>$<span id="swear-amount"></span></span>
		</div>
		<div class="progress-bar-container" id="progress">
			<div class="progress-header">
				<div class="progress-header-text">Total Progress</div>
				<div class="progress-percent">{{ Math.floor((entity.sumDonations / entity.fundraisingGoal) * 100)
					}}%</div>
			</div>
			<div class="progress">
				<div class="progress-bar progress-bar-grow bg-blue" role="progressbar"
					v-bind:style="{ width: ((entity.sumDonations / entity.fundraisingGoal) * 100) + '%' }">
				</div>
			</div>
		</div>
		<!-- <div class="donors">
			<span id="donors-header" class="donors-header">DONORS</span>
			<span id="donation" class="donation"></span>
		</div> -->
		<!-- <div class="incentives">
			<span class="incentives-header">+$20 gets you a wheel spin for a chance at:</span>
			<div class="incentives-value incentives-value-1">
				<span>1 spoon of hotsauce</span>
				<span>1 spoon of vegemite</span>
				<span>1 bite of onion</span>
				<span>10 pushups</span>
				<span>10 situps</span>
				<span>10 squats</span>
				<span>Jackpot, all six in a row!</span>
			</div>
		</div> -->
		<script src="combo-page-live.js"></script>
</body>
<script type="text/javascript">
	var auto_refresh = setInterval(
		function () {
			jQuery.get('../swear-jar/swear-jar.txt', function (data) {
				$('#swear-amount').html((data.replace('n', '')) * 5);
			});
		}, 10000
	);

</script>
<script>
	function showTime() {
		var date = new Date();
		var h = date.getHours(); // 0 - 23
		var m = date.getMinutes(); // 0 - 59
		var session = "AM";
		var separator = '<span class="separator">' + '<p>:</p>' + '</span>';

		if (h == 0) {
			h = 12;
		}

		if (h > 12) {
			h = h - 12;
			session = "PM";
		}

		h = (h < 10) ? "0" + h : h;
		m = (m < 10) ? "0" + m : m;

		document.getElementById("hours").innerText = h;
		document.getElementById("mins").textContent = m;

		setTimeout(showTime, 1000);

	}
	showTime();
</script>
<script>
	Vue.filter(
		'formatMoney',
		(value) => {
			return numeral(value).format('$0,0.00');
		}
	);

	var v = new Vue({
		data: {
			count: 0,
			donation: null,
			donations: [],
			entity: {
				etag: '',
				lastDonation: new Date().toISOString()
			}
		},
		el: '#progress',
		methods: {
			refreshDonations() {
				var ld = new Date(this.entity.lastDonation);

				axios.get(window.config.api + window.config.resource + '/' + window.config.resourceID + '/donations' + (window.config.api.indexOf('?') >= 0 ? '&' : '?') + 'where=' + encodeURIComponent('createdDateUTC > ' + ld.toISOString()) + '&orderBy=' + encodeURIComponent('createdDateUTC ASC'))
					.then((response) => {
						response.data.forEach((dx) => {
							var createdDate = new Date(dx.createdDateUTC);

							if (createdDate > ld) {
								this.donations.push(dx);
								this.entity.lastDonation = dx.createdDateUTC;
							}
						});
					});
			},
			refreshEntity() {
				axios.get(window.config.api + window.config.resource + '/' + window.config.resourceID, { headers: { 'if-none-match': this.entity.etag } })
					.then((response) => {
						// success
						var e = Object.assign({}, this.entity, response.data);
						e.etag = response.headers.etag;

						this.entity = e;

						if (window.config.streamingThermometer.showDonations) {
							this.refreshDonations();
						}
					})
					.catch((error) => { });
			}
		}
	});

	setInterval(
		() => {
			v.refreshEntity();
		},
		15000
	);

	if (window.config.streamingThermometer.showDonations) {
		setInterval(
			() => {
				if (v.donations.length) {
					v.donation = v.donations.shift();
					setTimeout(
						() => { v.donation = null; },
						5000
					);
				}
			},
			7000
		);
	}

	v.refreshEntity();
</script>
<script>
	$(document).ready(function () {
		var $spans = $('.incentives-value span');
		var currentSpanIndex = 0;

		function showNextSpan() {
			$spans.eq(currentSpanIndex).fadeIn(500, function () {
				setTimeout(function () {
					$spans.eq(currentSpanIndex).fadeOut(500, function () {
						currentSpanIndex = (currentSpanIndex + 1) % $spans.length;
						showNextSpan();
					});
				}, 4000);
			});
		}

		showNextSpan();
	});
</script>

</html>